<!DOCTYPE html>
<html> 
<head> 
    <meta charset="UTF-8">
    <title>THREE.js Water Shader Test</title> 
    <link rel="stylesheet" href="../styles.css" />
    <script src="../lib/three/build/three.150.min.js"></script>
    <script>globalThis.three = THREE;
    </script>
    <script src="../lib/three/examples/umd/lib/stats.module.js"></script> 
    <script>
        globalThis.module = globalThis;
    </script>
    <script src="../lib/tweakpane/tweakpane.min.js"></script>
    <script src="../module.js"></script>
    <script src="../lib/three/examples/umd/controls/OrbitControls.js"></script>
    <script>globalThis.three = THREE;</script>
    <script src="../lib/three/examples/umd/math/ImprovedNoise.js"></script>
    <script src="../utils/Helpers.js"></script> 
    <script src="../utils/texture/shaders/caustic_shader_material.glsl.js"></script>
    <script src="../utils/texture/CausticShaderMaterial.js"></script> 
    <script src="../utils/texture/PerlinTexture.js"></script> 
    <script src="../utils/math/perlin.js"></script> 
    <script src="../utils/math/PerlinHeightMap.js"></script> 
    <script src="../components/environment/PerlinTerrain.js"></script> 
    <script src="cutscene_test.js"></script> 
    <script id="vertexShader" type="x-shader/x-vertex">
        varying vec2 vUv; 
        varying vec3 vposition;

        void main() {
            // This is just the local position.
            vUv = uv; // position;
            // This is the global position in the world.
            vposition = (modelMatrix * vec4(position, 1.0)).xyz;

            vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);
            gl_Position = projectionMatrix * modelViewPosition; 
        }
    </script>

    <script id="fragmentShader" type="x-shader/x-fragment">

        #define FOG_EXP2 1

        // Scales the effect
        uniform float u_zoom;
        // The effect speed
        uniform float u_speed;
        // General brightness
        uniform float u_bright;
        // Intensity, like the maximal alpha value of the effect
        uniform float u_intensity;
        // The current shader animation time frame
        uniform float u_time;
        // The underlying texture to use
        uniform sampler2D u_texture;
        // The effect color on its peak brightness value
        uniform vec4 u_effect_color;
        // The shutter amount in 0.0 (close) to 1.0 (open)
        uniform float u_shutter_amount;

        // ### USE FOG 
        uniform vec3 fogColor;
        varying float vFogDepth;
        #ifdef FOG_EXP2
            uniform float fogDensity;
        #else
            uniform float fogNear;
            uniform float fogFar;
        #endif

        varying vec2 vUv;
        varying vec3 vposition;


        void main()
        {

            // TODO: pass pixel size as uniforms
            float canvasWidth = 100.0;
            float canvasHeight = 100.0;

            float shuter_width_0 = 3.0;
            float shuter_width_1 = 3.0;
            float shuter_width_2 = 3.0;

            float offsetY = floor( mod(vUv.y*canvasHeight, 3.0) );

            // float pctX = mod(u_shutter_amount, 1.0); // * 3.0;
            float pctX = clamp(u_shutter_amount, 0.0, 1.0); 


            float modX = 1.0 + mod( vUv.x*canvasWidth + offsetY, 3.0 );
            float transX = floor( (1.0/shuter_width_0) + modX * pctX );

            // uncoment when using real texture
            // vec4 texture_color = texture2D(u_texture, vUv.xy);
            vec4 light_color = vec4(1.0, 1.0, 1.0, 0.0);
            vec4 dark_color = vec4(0.0, 0.0, 0.0, 1.0);

            gl_FragColor = mix( light_color, dark_color, transX);
        }
    </script>

</head>

<body> 
    <div id="Stats-output">
    </div>
</body> 
</html>
